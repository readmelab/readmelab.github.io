<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ | ìš´ëª… ë³´ì¦ì„œ</title>
    <meta property="og:title" content="ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ â€” ìš´ëª… ë¶„ì„ ê²°ê³¼">
    <meta property="og:description" content="ë‹¹ì‹ ë§Œì„ ìœ„í•œ ì‚¬ì£¼ & MBTI ë§ì¶¤ ìš´ëª… ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.">
    <meta property="og:image" content="https://readmelab.github.io/og-image.png">
    <meta property="og:type" content="website">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0a0a14; color: #f5f0e8; font-family: 'Noto Sans KR', sans-serif; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { max-width: 480px; width: 100%; text-align: center; }
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; }
        .loading .spinner { width: 40px; height: 40px; border: 2px solid #c9a84c33; border-top: 2px solid #c9a84c; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { color: #8a7a5a; font-size: 14px; }
        .error { display: none; min-height: 60vh; flex-direction: column; align-items: center; justify-content: center; }
        .error h2 { font-family: 'Noto Serif KR', serif; color: #c9a84c; font-size: 20px; margin-bottom: 12px; }
        .error p { color: #8a7a5a; font-size: 14px; }
        .certificate { display: none; }
        .top-ornament { display: flex; align-items: center; justify-content: center; margin-bottom: 40px; gap: 12px; }
        .top-ornament .line { height: 1px; width: 60px; background: linear-gradient(90deg, transparent, #c9a84c, transparent); }
        .top-ornament .diamond { color: #c9a84c; font-size: 10px; }
        .brand { font-family: 'Noto Serif KR', serif; font-size: 13px; color: #c9a84c; letter-spacing: 6px; margin-bottom: 8px; }
        .cert-title { font-family: 'Noto Serif KR', serif; font-size: 15px; color: #8a7a5a; letter-spacing: 3px; margin-bottom: 32px; }
        .client-name { font-family: 'Noto Serif KR', serif; font-size: 36px; font-weight: 900; color: #c9a84c; margin-bottom: 4px; text-shadow: 0 0 20px rgba(201, 168, 76, 0.3); }
        .client-name-sub { font-family: 'Noto Serif KR', serif; font-size: 20px; font-weight: 700; color: #a09060; margin-bottom: 8px; display: none; }
        .name-divider { display: none; align-items: center; justify-content: center; gap: 10px; margin: 8px 0; }
        .name-divider .line { width: 30px; height: 1px; background: #c9a84c44; }
        .name-divider .and { color: #c9a84c88; font-size: 13px; font-family: 'Noto Serif KR', serif; }
        .honorific { font-size: 16px; color: #a09880; margin-bottom: 32px; }
        .divider { height: 1px; background: linear-gradient(90deg, transparent, #c9a84c33, #c9a84c, #c9a84c33, transparent); margin: 24px 0; }
        .message { font-size: 14px; color: #a09880; line-height: 1.8; margin-bottom: 36px; font-weight: 300; }
        .product-tag { display: inline-block; padding: 4px 16px; border: 1px solid #c9a84c33; border-radius: 20px; font-size: 12px; color: #c9a84c; margin-bottom: 24px; letter-spacing: 1px; }
        .buttons { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
        .btn { display: none; align-items: center; justify-content: center; gap: 10px; padding: 16px 24px; border: 1px solid #c9a84c44; border-radius: 8px; background: linear-gradient(135deg, #1a1a2e, #16162a); color: #e8dcc8; text-decoration: none; font-size: 15px; font-weight: 500; transition: all 0.3s ease; letter-spacing: 1px; }
        .btn.active { display: flex; }
        .btn:hover { background: linear-gradient(135deg, #2a2a3e, #20203a); border-color: #c9a84c88; box-shadow: 0 0 20px rgba(201, 168, 76, 0.15); transform: translateY(-1px); }
        .btn .icon { font-size: 18px; }
        .btn-row { display: none; gap: 12px; }
        .btn-row.active { display: flex; }
        .btn-row .btn { flex: 1; font-size: 13px; padding: 14px 12px; }
        .btn-row .btn.active { display: flex; }
        .footer { margin-top: 40px; padding-top: 24px; }
        .footer-brand { font-family: 'Noto Serif KR', serif; font-size: 12px; color: #5a5040; letter-spacing: 2px; }
        .footer-sub { font-size: 11px; color: #3a3530; margin-top: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading"><div class="spinner"></div><p>ë³´ì¦ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p></div>
        <div class="error" id="error"><h2>ë³´ì¦ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2><p>ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”</p></div>
        <div class="certificate" id="certificate">
            <div class="top-ornament"><div class="line"></div><div class="diamond">â—†</div><div class="line"></div></div>
            <div class="brand">ë‚˜ë¥¼ì½ë‹¤</div>
            <div class="cert-title" id="certTitle">ìš´ ëª… ê³µ ëª… ë³´ ì¦ ì„œ</div>
            <div class="client-name" id="clientName"></div>
            <div class="name-divider" id="nameDivider"><div class="line"></div><div class="and">&</div><div class="line"></div></div>
            <div class="client-name-sub" id="clientName2"></div>
            <div class="honorific" id="honorific">ë‹˜ì˜ ìš´ëª… ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</div>
            <div class="product-tag" id="productTag"></div>
            <div class="divider"></div>
            <div class="message" id="message">ê·€í•˜ì˜ ì‚¬ì£¼ ì˜¤í–‰ê³¼ MBTI ì‹¬ë¦¬ ìœ í˜•ì„<br>ë¶„ì„í•˜ì—¬ ì¡°ìœ¨ëœ ë§ì¶¤í˜• ì†”ë£¨ì…˜ì…ë‹ˆë‹¤</div>
            <div class="buttons">
                <a href="#" class="btn" id="btnPdf" target="_blank"><span class="icon">ğŸ“œ</span><span id="btnPdfText">ì‚¬ì£¼ ë¶„ì„ ë¦¬í¬íŠ¸</span></a>
                <a href="#" class="btn" id="btnTheme" target="_blank"><span class="icon">ğŸµ</span><span id="btnThemeText">ë§ì¶¤í˜• ìŒì›</span></a>
                <a href="#" class="btn" id="btnVoice" target="_blank"><span class="icon">ğŸ§</span><span id="btnVoiceText">ìŒì„± í•´ì„¤</span></a>
                <a href="#" class="btn" id="btnHealing" target="_blank"><span class="icon">ğŸ¶</span><span id="btnHealingText">íë§ìŒì•…</span></a>
            </div>
            <div class="footer"><div class="divider"></div><div class="footer-brand">ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ</div><div class="footer-sub">ì‚¬ì£¼ & MBTI ìš´ëª… ë¶„ì„</div></div>
        </div>
    </div>
    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSLwX3_NEYRLeNv8UmKxsL9vrTHmHwMcSWtu7uGuIUyV79m8Qhw6jLJtxOPjIEzxNt1Ks7nqYaKnlb2/pub?gid=0&single=true&output=csv';
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('c');
        if (!code) { showError(); } else { loadCertificate(code); }

        function toDirectLink(url) {
            if (!url) return url;
            var docsMatch = url.match(/docs\.google\.com\/document\/d\/([a-zA-Z0-9_-]+)/);
            if (docsMatch) {
                return 'https://docs.google.com/document/d/' + docsMatch[1] + '/export?format=pdf';
            }
            var driveMatch = url.match(/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                return 'https://drive.google.com/uc?export=download&id=' + driveMatch[1];
            }
            var openMatch = url.match(/drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/);
            if (openMatch) {
                return 'https://drive.google.com/uc?export=download&id=' + openMatch[1];
            }
            return url;
        }

        async function loadCertificate(code) {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                const rows = csvText.split('\n').map(row => parseCSVRow(row));
                const header = rows[0];

                const codeIndex = header.findIndex(h => h.trim() === 'ë³´ì¦ì½”ë“œ');
                if (codeIndex === -1) { showError(); return; }

                const customerRow = rows.find((row, i) => i > 0 && row[codeIndex] && row[codeIndex].trim() === code);
                if (!customerRow) { showError(); return; }

                const getData = (colName) => {
                    const idx = header.findIndex(h => h.trim() === colName);
                    return idx !== -1 ? (customerRow[idx] || '').trim() : '';
                };

                const name = getData('ì£¼ì¸ê³µ1');
                const name2 = getData('ì£¼ì¸ê³µ2');
                const product = getData('ìƒí’ˆ');

                const pdfLink     = getData('PDF');
                const pdfName     = getData('PDFëª…');
                const themeLink   = getData('í…Œë§ˆê³¡');
                const themeName   = getData('í…Œë§ˆê³¡ëª…');
                const voiceLink   = getData('ìŒì„±');
                const voiceName   = getData('ìŒì„±ëª…');
                const healingLink = getData('íë§');
                const healingName = getData('íë§ëª…');

                document.getElementById('clientName').textContent = name;
                document.getElementById('productTag').textContent = product;

                const isCouple = product.includes('ìš°ë¦¬');
                if (isCouple && name2) {
                    document.getElementById('nameDivider').style.display = 'flex';
                    document.getElementById('clientName2').style.display = 'block';
                    document.getElementById('clientName2').textContent = name2;
                }

                if (isCouple) {
                    document.getElementById('certTitle').textContent = 'ìš´ ëª… ê¶ í•© ë³´ ì¦ ì„œ';
                    document.getElementById('honorific').textContent = 'ë‹˜ì˜ ê¶í•© ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤';
                    document.getElementById('message').innerHTML = 'ë‘ ë¶„ì˜ ì‚¬ì£¼ ì˜¤í–‰ê³¼ MBTI ì‹¬ë¦¬ ìœ í˜•ì„<br>ë¶„ì„í•˜ì—¬ ì¡°ìœ¨ëœ ë§ì¶¤í˜• ì†”ë£¨ì…˜ì…ë‹ˆë‹¤';
                }

                if (pdfLink) {
                    document.getElementById('btnPdf').href = toDirectLink(pdfLink);
                    document.getElementById('btnPdf').classList.add('active');
                    if (pdfName) document.getElementById('btnPdfText').textContent = pdfName;
                }
                if (themeLink) {
                    document.getElementById('btnTheme').href = toDirectLink(themeLink);
                    document.getElementById('btnTheme').classList.add('active');
                    if (themeName) document.getElementById('btnThemeText').textContent = themeName;
                }
                if (voiceLink) {
                    document.getElementById('btnVoice').href = toDirectLink(voiceLink);
                    document.getElementById('btnVoice').classList.add('active');
                    if (voiceName) document.getElementById('btnVoiceText').textContent = voiceName;
                }
                if (healingLink) {
                    document.getElementById('btnHealing').href = toDirectLink(healingLink);
                    document.getElementById('btnHealing').classList.add('active');
                    if (healingName) document.getElementById('btnHealingText').textContent = healingName;
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('certificate').style.display = 'block';
            } catch (e) {
                showError();
            }
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') { inQuotes = !inQuotes; }
                else if (char === ',' && !inQuotes) { result.push(current); current = ''; }
                else { current += char; }
            }
            result.push(current);
            return result;
        }
    </script>
</body>
</html>
