<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ | ìš´ëª… ë³´ì¦ì„œ</title>
    <meta property="og:title" content="ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ â€” ìš´ëª… ë¶„ì„ ê²°ê³¼">
    <meta property="og:description" content="ë‹¹ì‹ ë§Œì„ ìœ„í•œ ì‚¬ì£¼ & MBTI ë§ì¶¤ ìš´ëª… ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.">
    <meta property="og:image" content="https://readmelab.github.io/og-image.png">
    <meta property="og:type" content="website">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0a0a14; color: #f5f0e8; font-family: 'Noto Sans KR', sans-serif; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { max-width: 480px; width: 100%; text-align: center; }

        /* ë¡œë”© & ì—ëŸ¬ */
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; }
        .loading .spinner { width: 40px; height: 40px; border: 2px solid #c9a84c33; border-top: 2px solid #c9a84c; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading p { color: #8a7a5a; font-size: 14px; }
        .error { display: none; min-height: 60vh; flex-direction: column; align-items: center; justify-content: center; }
        .error h2 { font-family: 'Noto Serif KR', serif; color: #c9a84c; font-size: 20px; margin-bottom: 12px; }
        .error p { color: #8a7a5a; font-size: 14px; }

        /* ì§„ì… í™”ë©´ */
        .intro { display: none; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; }
        .intro-brand { font-family: 'Noto Serif KR', serif; font-size: 13px; color: #c9a84c; letter-spacing: 6px; margin-bottom: 16px; opacity: 0; animation: introFadeIn 1s ease forwards 0.3s; }
        .intro-symbol { font-size: 24px; color: #c9a84c; margin-bottom: 24px; opacity: 0; animation: introFadeIn 1s ease forwards 0.6s; text-shadow: 0 0 40px rgba(201, 168, 76, 0.6), 0 0 80px rgba(201, 168, 76, 0.3); }
        .intro-title { font-family: 'Noto Serif KR', serif; font-size: 15px; color: #8a7a5a; letter-spacing: 3px; margin-bottom: 40px; opacity: 0; animation: introFadeIn 1s ease forwards 0.9s; }
        .intro-btn { display: inline-block; padding: 16px 48px; border: 1px solid #c9a84c66; border-radius: 4px; background: transparent; color: #c9a84c; font-family: 'Noto Serif KR', serif; font-size: 15px; letter-spacing: 3px; cursor: pointer; transition: all 0.3s ease; opacity: 0; animation: introFadeIn 1s ease forwards 1.2s; }
        .intro-btn:hover { background: #c9a84c11; border-color: #c9a84c; box-shadow: 0 0 30px rgba(201, 168, 76, 0.2); }
        @keyframes introFadeIn { to { opacity: 1; } }

        /* ì§„ì…â†’ë³´ì¦ì„œ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .intro.fade-out { animation: fadeOut 0.8s ease forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }

        /* ë³´ì¦ì„œ */
        .certificate { display: none; opacity: 0; }
        .certificate.fade-in { animation: certFadeIn 1.5s ease forwards; }
        @keyframes certFadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .top-ornament { display: flex; align-items: center; justify-content: center; margin-bottom: 40px; gap: 12px; }
        .top-ornament .line { height: 1px; width: 60px; background: linear-gradient(90deg, transparent, #c9a84c, transparent); }
        .top-ornament .diamond { color: #c9a84c; font-size: 10px; }
        .brand { font-family: 'Noto Serif KR', serif; font-size: 13px; color: #c9a84c; letter-spacing: 6px; margin-bottom: 8px; }
        .cert-title { font-family: 'Noto Serif KR', serif; font-size: 15px; color: #8a7a5a; letter-spacing: 3px; margin-bottom: 32px; }
        .client-name { font-family: 'Noto Serif KR', serif; font-size: 36px; font-weight: 900; color: #c9a84c; margin-bottom: 4px; text-shadow: 0 0 20px rgba(201, 168, 76, 0.3); }
        .client-name-sub { font-family: 'Noto Serif KR', serif; font-size: 20px; font-weight: 700; color: #a09060; margin-bottom: 8px; display: none; }
        .name-divider { display: none; align-items: center; justify-content: center; gap: 10px; margin: 8px 0; }
        .name-divider .line { width: 30px; height: 1px; background: #c9a84c44; }
        .name-divider .and { color: #c9a84c88; font-size: 13px; font-family: 'Noto Serif KR', serif; }
        .honorific { font-size: 16px; color: #a09880; margin-bottom: 32px; }
        .divider { height: 1px; background: linear-gradient(90deg, transparent, #c9a84c33, #c9a84c, #c9a84c33, transparent); margin: 24px 0; }
        .message { font-size: 14px; color: #a09880; line-height: 1.8; margin-bottom: 36px; font-weight: 300; }
        .sore-line { font-family: 'Noto Serif KR', serif; font-size: 20px; color: #c9a84c; font-weight: 700; line-height: 2.2; letter-spacing: 1px; text-shadow: 0 0 30px rgba(201, 168, 76, 0.2); }
        .product-tag { display: inline-block; padding: 4px 16px; border: 1px solid #c9a84c33; border-radius: 20px; font-size: 12px; color: #c9a84c; margin-bottom: 24px; letter-spacing: 1px; }

        /* ë²„íŠ¼ & í”Œë ˆì´ì–´ */
        .buttons { display: flex; flex-direction: column; gap: 0; margin-bottom: 16px; }
        .btn-item { margin-bottom: 12px; }
        .btn { display: none; align-items: center; justify-content: center; gap: 10px; padding: 16px 24px; border: 1px solid #c9a84c44; border-radius: 8px; background: linear-gradient(135deg, #1a1a2e, #16162a); color: #e8dcc8; text-decoration: none; font-size: 15px; font-weight: 500; transition: all 0.3s ease; letter-spacing: 1px; cursor: pointer; width: 100%; }
        .btn.active { display: flex; }
        .btn.playing { border-color: #c9a84c; box-shadow: 0 0 20px rgba(201, 168, 76, 0.2); }
        .btn:hover { background: linear-gradient(135deg, #2a2a3e, #20203a); border-color: #c9a84c88; box-shadow: 0 0 20px rgba(201, 168, 76, 0.15); transform: translateY(-1px); }
        .btn .icon { font-size: 18px; }
        .btn.expanded { border-radius: 8px 8px 0 0; border-bottom-color: transparent; }

        .player-wrap { display: none; border: 1px solid #c9a84c33; border-top: none; border-radius: 0 0 8px 8px; background: linear-gradient(135deg, #12121f, #0e0e1a); padding: 20px 16px; margin-top: -1px; }
        .player-wrap.open { display: block; }
        .player-visual { display: flex; align-items: center; gap: 14px; margin-bottom: 16px; }
        .player-icon-wrap { width: 52px; height: 52px; border-radius: 50%; border: 1px solid #c9a84c44; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; background: #c9a84c11; }
        .player-info { text-align: left; }
        .player-subtitle { font-size: 11px; color: #8a7a5a; letter-spacing: 1px; margin-bottom: 2px; }
        .player-title { font-size: 14px; color: #e8dcc8; font-weight: 500; }
        .player-controls { display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .player-play-btn { width: 36px; height: 36px; border-radius: 50%; border: 1px solid #c9a84c66; background: transparent; color: #c9a84c; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
        .player-play-btn:hover { background: #c9a84c22; border-color: #c9a84c; }
        .player-progress-wrap { flex: 1; }
        .player-progress { width: 100%; height: 4px; border-radius: 2px; appearance: none; -webkit-appearance: none; outline: none; cursor: pointer; background: #c9a84c22; }
        .player-progress::-webkit-slider-runnable-track { height: 4px; border-radius: 2px; }
        .player-progress::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; border-radius: 50%; background: #c9a84c; margin-top: -4px; cursor: pointer; }
        .player-progress::-moz-range-track { height: 4px; border-radius: 2px; background: #c9a84c22; }
        .player-progress::-moz-range-thumb { width: 12px; height: 12px; border-radius: 50%; background: #c9a84c; cursor: pointer; border: none; }
        .player-time { display: flex; justify-content: space-between; font-size: 10px; color: #6a6050; margin-top: 4px; }
        .player-bottom { display: flex; justify-content: center; margin-top: 12px; }
        .player-desc { font-size: 12px; color: #8a7a5a; font-style: italic; line-height: 1.6; margin-top: 8px; padding: 8px 12px; border-left: 2px solid #c9a84c33; display: none; }
        .player-download { display: inline-flex; align-items: center; gap: 6px; padding: 6px 16px; border: 1px solid #c9a84c33; border-radius: 20px; background: transparent; color: #8a7a5a; font-size: 11px; text-decoration: none; transition: all 0.2s; letter-spacing: 1px; }
        .player-download:hover { color: #c9a84c; border-color: #c9a84c66; }
        .player-loading { text-align: center; color: #8a7a5a; font-size: 12px; padding: 10px 0; }
        .player-loading .mini-spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid #c9a84c33; border-top: 2px solid #c9a84c; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 6px; vertical-align: middle; }

        /* ë°°ê²½ìŒì•… í‘œì‹œ ë°” */
        .bgm-bar { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #12121f, #0e0e1a); border-top: 1px solid #c9a84c33; padding: 10px 16px; z-index: 9998; }
        .bgm-bar.active { display: flex; align-items: center; gap: 12px; }
        .bgm-bar-info { flex: 1; min-width: 0; }
        .bgm-bar-title { font-size: 12px; color: #c9a84c; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bgm-bar-sub { font-size: 10px; color: #6a6050; margin-top: 2px; }
        .bgm-bar-btn { width: 32px; height: 32px; border-radius: 50%; border: 1px solid #c9a84c66; background: transparent; color: #c9a84c; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

        /* í‘¸í„° */
        .footer { margin-top: 40px; padding-top: 24px; padding-bottom: 60px; }
        .footer-brand { font-family: 'Noto Serif KR', serif; font-size: 12px; color: #5a5040; letter-spacing: 2px; }
        .footer-sub { font-size: 11px; color: #3a3530; margin-top: 4px; }

        /* PDF ì˜¤ë²„ë ˆì´ */
        .pdf-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background: #0a0a14; flex-direction: column; }
        .pdf-overlay.open { display: flex; }
        .pdf-overlay-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #0f0f1a; border-bottom: 1px solid #c9a84c33; flex-shrink: 0; }
        .pdf-overlay-title { font-size: 14px; color: #c9a84c; font-weight: 500; letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; margin-right: 12px; }
        .pdf-overlay-actions { display: flex; gap: 8px; flex-shrink: 0; }
        .pdf-overlay-btn { padding: 6px 14px; border: 1px solid #c9a84c44; border-radius: 20px; background: transparent; color: #8a7a5a; font-size: 12px; cursor: pointer; text-decoration: none; transition: all 0.2s; display: inline-flex; align-items: center; gap: 4px; font-family: 'Noto Sans KR', sans-serif; }
        .pdf-overlay-btn:hover { color: #c9a84c; border-color: #c9a84c66; }
        .pdf-overlay-close { width: 36px; height: 36px; border: 1px solid #c9a84c44; border-radius: 50%; background: transparent; color: #c9a84c; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
        .pdf-overlay-close:hover { background: #c9a84c22; border-color: #c9a84c; }
        .pdf-overlay-body { flex: 1; overflow: hidden; }
        .pdf-overlay-frame { width: 100%; height: 100%; border: none; background: #1a1a2e; }
        .pdf-overlay-loading { display: flex; align-items: center; justify-content: center; height: 100%; color: #8a7a5a; font-size: 14px; flex-direction: column; gap: 16px; }
        .pdf-overlay-loading .spinner { width: 32px; height: 32px; border: 2px solid #c9a84c33; border-top: 2px solid #c9a84c; border-radius: 50%; animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œë”© -->
        <div class="loading" id="loading"><div class="spinner"></div><p>ë³´ì¦ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p></div>

        <!-- ì—ëŸ¬ -->
        <div class="error" id="error"><h2>ë³´ì¦ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2><p>ë§í¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”</p></div>

        <!-- ì§„ì… í™”ë©´ -->
        <div class="intro" id="intro">
            <div class="intro-brand">ë‚˜ë¥¼ì½ë‹¤</div>
            <div class="intro-symbol">â—†</div>
            <div class="intro-title" id="introTitle">ìš´ëª… ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</div>
            <button class="intro-btn" id="introBtn" onclick="enterCertificate()">ë³´ì¦ì„œ í™•ì¸í•˜ê¸°</button>
        </div>

        <!-- ë³´ì¦ì„œ ë³¸ë¬¸ -->
        <div class="certificate" id="certificate">
            <div class="top-ornament"><div class="line"></div><div class="diamond">â—†</div><div class="line"></div></div>
            <div class="brand">ë‚˜ë¥¼ì½ë‹¤</div>
            <div class="cert-title" id="certTitle">ìš´ ëª… ê³µ ëª… ë³´ ì¦ ì„œ</div>
            <div class="client-name" id="clientName"></div>
            <div class="name-divider" id="nameDivider"><div class="line"></div><div class="and">&</div><div class="line"></div></div>
            <div class="client-name-sub" id="clientName2"></div>
            <div class="honorific" id="honorific">ë‹˜ì˜ ìš´ëª… ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</div>
            <div class="product-tag" id="productTag"></div>
            <div class="divider"></div>
            <div class="message" id="message">ê·€í•˜ì˜ ì‚¬ì£¼ ì˜¤í–‰ê³¼ MBTI ì‹¬ë¦¬ ìœ í˜•ì„<br>ë¶„ì„í•˜ì—¬ ì¡°ìœ¨ëœ ë§ì¶¤í˜• ì†”ë£¨ì…˜ì…ë‹ˆë‹¤</div>
            <div class="buttons" id="buttons">
                <!-- PDF -->
                <div class="btn-item" id="pdfItem">
                    <div class="btn" id="btnPdf" onclick="openPdfViewer()">
                        <span class="icon">ğŸ“œ</span><span id="btnPdfText">ì‚¬ì£¼ ë¶„ì„ ë¦¬í¬íŠ¸</span>
                    </div>
                </div>
                <!-- í…Œë§ˆê³¡ -->
                <div class="btn-item" id="themeItem">
                    <div class="btn" id="btnTheme" onclick="togglePlayer('theme')"><span class="icon">ğŸµ</span><span id="btnThemeText">ë§ì¶¤í˜• ìŒì›</span></div>
                    <div class="player-wrap" id="playerTheme">
                        <div class="player-loading" id="themeLoading" style="display:none;"><span class="mini-spinner"></span>ìŒì›ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        <div class="player-visual">
                            <div class="player-icon-wrap" id="themeIcon">ğŸµ</div>
                            <div class="player-info">
                                <div class="player-subtitle" id="themeSubtitle">ë‹¹ì‹ ë§Œì„ ìœ„í•œ ìŒì›</div>
                                <div class="player-title" id="themeTitle">ë§ì¶¤í˜• ìŒì›</div>
                            </div>
                        </div>
                        <div class="player-controls">
                            <button class="player-play-btn" id="themePlayBtn" onclick="playPause('theme')">â–¶</button>
                            <div class="player-progress-wrap">
                                <input type="range" class="player-progress" id="themeProgress" min="0" max="100" value="0" oninput="seek('theme')">
                                <div class="player-time"><span id="themeCurrent">0:00</span><span id="themeDuration">0:00</span></div>
                            </div>
                        </div>
                        <div class="player-desc" id="themeDesc"></div>
                        <div class="player-bottom">
                            <a href="#" class="player-download" id="themeDownload" target="_blank">â¬‡ ë‹¤ìš´ë¡œë“œ</a>
                        </div>
                    </div>
                </div>
                <!-- ìŒì„± -->
                <div class="btn-item" id="voiceItem">
                    <div class="btn" id="btnVoice" onclick="togglePlayer('voice')"><span class="icon">ğŸ§</span><span id="btnVoiceText">ìŒì„± í•´ì„¤</span></div>
                    <div class="player-wrap" id="playerVoice">
                        <div class="player-loading" id="voiceLoading" style="display:none;"><span class="mini-spinner"></span>ìŒì›ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        <div class="player-visual">
                            <div class="player-icon-wrap" id="voiceIcon">ğŸ§</div>
                            <div class="player-info">
                                <div class="player-subtitle" id="voiceSubtitle">ë‹¹ì‹ ë§Œì„ ìœ„í•œ í•´ì„¤</div>
                                <div class="player-title" id="voiceTitle">ìŒì„± í•´ì„¤</div>
                            </div>
                        </div>
                        <div class="player-controls">
                            <button class="player-play-btn" id="voicePlayBtn" onclick="playPause('voice')">â–¶</button>
                            <div class="player-progress-wrap">
                                <input type="range" class="player-progress" id="voiceProgress" min="0" max="100" value="0" oninput="seek('voice')">
                                <div class="player-time"><span id="voiceCurrent">0:00</span><span id="voiceDuration">0:00</span></div>
                            </div>
                        </div>
                        <div class="player-desc" id="voiceDesc"></div>
                        <div class="player-bottom">
                            <a href="#" class="player-download" id="voiceDownload" target="_blank">â¬‡ ë‹¤ìš´ë¡œë“œ</a>
                        </div>
                    </div>
                </div>
                <!-- íë§ -->
                <div class="btn-item" id="healingItem">
                    <div class="btn" id="btnHealing" onclick="togglePlayer('healing')"><span class="icon">ğŸ¶</span><span id="btnHealingText">íë§ìŒì•…</span></div>
                    <div class="player-wrap" id="playerHealing">
                        <div class="player-loading" id="healingLoading" style="display:none;"><span class="mini-spinner"></span>ìŒì›ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        <div class="player-visual">
                            <div class="player-icon-wrap" id="healingIcon">ğŸ¶</div>
                            <div class="player-info">
                                <div class="player-subtitle" id="healingSubtitle">ë‹¹ì‹ ë§Œì„ ìœ„í•œ ìŒì•…</div>
                                <div class="player-title" id="healingTitle">íë§ìŒì•…</div>
                            </div>
                        </div>
                        <div class="player-controls">
                            <button class="player-play-btn" id="healingPlayBtn" onclick="playPause('healing')">â–¶</button>
                            <div class="player-progress-wrap">
                                <input type="range" class="player-progress" id="healingProgress" min="0" max="100" value="0" oninput="seek('healing')">
                                <div class="player-time"><span id="healingCurrent">0:00</span><span id="healingDuration">0:00</span></div>
                            </div>
                        </div>
                        <div class="player-desc" id="healingDesc"></div>
                        <div class="player-bottom">
                            <a href="#" class="player-download" id="healingDownload" target="_blank">â¬‡ ë‹¤ìš´ë¡œë“œ</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer"><div class="divider"></div><div class="footer-brand">ë‚˜ë¥¼ì½ë‹¤ ì—°êµ¬ì†Œ</div><div class="footer-sub">ì‚¬ì£¼ & MBTI ìš´ëª… ë¶„ì„</div></div>
        </div>
    </div>

    <!-- ë°°ê²½ìŒì•… ë°” -->
    <div class="bgm-bar" id="bgmBar">
        <button class="bgm-bar-btn" id="bgmBtn" onclick="toggleBgm()">â¸</button>
        <div class="bgm-bar-info">
            <div class="bgm-bar-title" id="bgmTitle">â™ª ë§ì¶¤í˜• ìŒì›</div>
            <div class="bgm-bar-sub">ë°°ê²½ìŒì•… ì¬ìƒ ì¤‘</div>
        </div>
    </div>

    <!-- PDF ì˜¤ë²„ë ˆì´ -->
    <div class="pdf-overlay" id="pdfOverlay">
        <div class="pdf-overlay-header">
            <div class="pdf-overlay-title" id="pdfOverlayTitle">ğŸ“œ ì‚¬ì£¼ ë¶„ì„ ë¦¬í¬íŠ¸</div>
            <div class="pdf-overlay-actions">
                <a href="#" class="pdf-overlay-btn" id="pdfOverlayDownload" target="_blank">â¬‡</a>
                <button class="pdf-overlay-close" onclick="closePdfViewer()">âœ•</button>
            </div>
        </div>
        <div class="pdf-overlay-body" id="pdfOverlayBody">
            <div class="pdf-overlay-loading" id="pdfOverlayLoading">
                <div class="spinner"></div>
                <span>ë¦¬í¬íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
            </div>
            <iframe class="pdf-overlay-frame" id="pdfOverlayFrame" src="" style="display:none;"></iframe>
        </div>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSLwX3_NEYRLeNv8UmKxsL9vrTHmHwMcSWtu7uGuIUyV79m8Qhw6jLJtxOPjIEzxNt1Ks7nqYaKnlb2/pub?gid=0&single=true&output=csv';
        const PROXY_URL = 'https://script.google.com/macros/s/AKfycbwmOwIYOV-dTqynZDAAYnJwWW9wOZubnpTducblAZOuPNUT36-q3r6LORlmZiqAyS0g/exec';

        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('c');
        if (!code) { showError(); } else { loadCertificate(code); }

        /* â”€â”€ ìœ í‹¸ â”€â”€ */
        function extractFileId(url) {
            if (!url) return null;
            var m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
            if (m) return m[1];
            m = url.match(/id=([a-zA-Z0-9_-]+)/);
            if (m) return m[1];
            return null;
        }

        function toDirectLink(url) {
            var id = extractFileId(url);
            if (!id) return url;
            if (url.indexOf('docs.google.com/document') !== -1) {
                return 'https://docs.google.com/document/d/' + id + '/export?format=pdf';
            }
            return 'https://drive.google.com/uc?export=download&id=' + id;
        }

        function toStreamUrl(url) {
            var id = extractFileId(url);
            if (!id) return url;
            return 'https://drive.google.com/uc?export=download&id=' + id;
        }

        function buildPdfUrls(rawUrl) {
            if (!rawUrl) return { embed: '', download: '' };
            var fileId = extractFileId(rawUrl);
            if (!fileId) return { embed: rawUrl, download: rawUrl };
            if (rawUrl.indexOf('docs.google.com/document') !== -1) {
                return { embed: 'https://docs.google.com/document/d/' + fileId + '/preview', download: 'https://docs.google.com/document/d/' + fileId + '/export?format=pdf' };
            }
            return { embed: 'https://drive.google.com/file/d/' + fileId + '/preview', download: 'https://drive.google.com/uc?export=download&id=' + fileId };
        }

        function formatTime(sec) {
            if (!sec || isNaN(sec)) return '0:00';
            var m = Math.floor(sec / 60);
            var s = Math.floor(sec % 60);
            return m + ':' + (s < 10 ? '0' : '') + s;
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < row.length; i++) {
                const ch = row[i];
                if (inQuotes) {
                    if (ch === '"' && row[i + 1] === '"') { current += '"'; i++; }
                    else if (ch === '"') { inQuotes = false; }
                    else { current += ch; }
                } else {
                    if (ch === '"') { inQuotes = true; }
                    else if (ch === ',') { result.push(current); current = ''; }
                    else { current += ch; }
                }
            }
            result.push(current);
            return result;
        }

        /* â”€â”€ ìƒíƒœ ë³€ìˆ˜ â”€â”€ */
        var pdfViewerData = { embedUrl: '', downloadUrl: '', title: '' };
        var audioPlayers = {};
        var audioLoaded = {};
        var audioStreamUrls = {};
        var playerIntervals = {};
        var bgmType = null;
        var certData = {};

        /* â”€â”€ ë°ì´í„° ë¡œë“œ â”€â”€ */
        async function loadCertificate(code) {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                const rows = csvText.split('\n');

                let found = null;
                for (let i = 1; i < rows.length; i++) {
                    const cols = parseCSVRow(rows[i]);
                    if (cols[19] && cols[19].trim() === code) {
                        found = cols;
                        break;
                    }
                }
                if (!found) { showError(); return; }

                certData = {
                    name: found[1] || found[3] || '',
                    name2: found[2] || '',
                    product: found[4] || '',
                    pdfLink: found[10] || '',
                    pdfName: found[11] || '',
                    themeLink: found[12] || '',
                    themeName: found[13] || '',
                    voiceLink: found[14] || '',
                    voiceName: found[15] || '',
                    healingLink: found[16] || '',
                    healingName: found[17] || '',
                    soreLine: (found[28] || '').trim(),
                    themeDesc: (found[29] || '').trim(),
                    voiceDesc: (found[30] || '').trim(),
                    healingDesc: (found[31] || '').trim()
                };

                var isCouple = certData.product.includes('ìš°ë¦¬');

                /* ì§„ì… í™”ë©´ íƒ€ì´í‹€ ì„¤ì • */
                document.getElementById('introTitle').textContent =
                    certData.name + (isCouple && certData.name2 ? ' & ' + certData.name2 : '') + 'ë‹˜ì˜ ' + (isCouple ? 'ê¶í•©' : 'ìš´ëª…') + ' ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤';

                /* ë¡œë”© â†’ ì§„ì… í™”ë©´ ì „í™˜ */
                document.getElementById('loading').style.display = 'none';
                document.getElementById('intro').style.display = 'flex';

            } catch (e) {
                showError();
            }
        }

        /* â”€â”€ ì§„ì… ì—°ì¶œ â”€â”€ */
        function enterCertificate() {
            var intro = document.getElementById('intro');
            var cert = document.getElementById('certificate');
            var d = certData;
            var isCouple = d.product.includes('ìš°ë¦¬');
            var subtitleText = isCouple ? 'ë‘ ë¶„ì„ ìœ„í•œ' : 'ë‹¹ì‹ ë§Œì„ ìœ„í•œ';

            /* ë³´ì¦ì„œ ë‚´ìš© ì±„ìš°ê¸° */
            document.getElementById('clientName').textContent = d.name;
            document.getElementById('productTag').textContent = d.product;

            if (isCouple && d.name2) {
                document.getElementById('nameDivider').style.display = 'flex';
                document.getElementById('clientName2').style.display = 'block';
                document.getElementById('clientName2').textContent = d.name2;
            }
            if (isCouple) {
                document.getElementById('certTitle').textContent = 'ìš´ ëª… ê¶ í•© ë³´ ì¦ ì„œ';
                document.getElementById('honorific').textContent = 'ë‹˜ì˜ ê¶í•© ë¶„ì„ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤';
                document.getElementById('message').innerHTML = 'ë‘ ë¶„ì˜ ì‚¬ì£¼ ì˜¤í–‰ê³¼ MBTI ì‹¬ë¦¬ ìœ í˜•ì„<br>ë¶„ì„í•˜ì—¬ ì¡°ìœ¨ëœ ë§ì¶¤í˜• ì†”ë£¨ì…˜ì…ë‹ˆë‹¤';
            }
            if (d.soreLine) {
                document.getElementById('message').innerHTML = '<span class="sore-line">"' + d.soreLine + '"</span>';
            }

            /* PDF */
            if (d.pdfLink) {
                var pdfUrls = buildPdfUrls(d.pdfLink);
                pdfViewerData.embedUrl = pdfUrls.embed;
                pdfViewerData.downloadUrl = pdfUrls.download;
                pdfViewerData.title = d.pdfName || 'ì‚¬ì£¼ ë¶„ì„ ë¦¬í¬íŠ¸';
                document.getElementById('btnPdf').classList.add('active');
                if (d.pdfName) document.getElementById('btnPdfText').textContent = d.pdfName;
            }

            /* í…Œë§ˆê³¡ */
            if (d.themeLink) {
                document.getElementById('btnTheme').classList.add('active');
                if (d.themeName) document.getElementById('btnThemeText').textContent = d.themeName;
                document.getElementById('themeTitle').textContent = d.themeName || 'ë§ì¶¤í˜• ìŒì›';
                document.getElementById('themeSubtitle').textContent = subtitleText + ' ìŒì›';
                document.getElementById('themeDownload').href = toDirectLink(d.themeLink);
                audioStreamUrls['theme'] = toStreamUrl(d.themeLink);
                if (d.themeDesc) {
                    document.getElementById('themeDesc').textContent = d.themeDesc;
                    document.getElementById('themeDesc').style.display = 'block';
                }
            }

            /* ìŒì„± */
            if (d.voiceLink) {
                document.getElementById('btnVoice').classList.add('active');
                if (d.voiceName) document.getElementById('btnVoiceText').textContent = d.voiceName;
                document.getElementById('voiceTitle').textContent = d.voiceName || 'ìŒì„± í•´ì„¤';
                document.getElementById('voiceSubtitle').textContent = subtitleText + ' í•´ì„¤';
                document.getElementById('voiceDownload').href = toDirectLink(d.voiceLink);
                audioStreamUrls['voice'] = toStreamUrl(d.voiceLink);
                if (d.voiceDesc) {
                    document.getElementById('voiceDesc').textContent = d.voiceDesc;
                    document.getElementById('voiceDesc').style.display = 'block';
                }
            }

            /* íë§ */
            if (d.healingLink) {
                document.getElementById('btnHealing').classList.add('active');
                if (d.healingName) document.getElementById('btnHealingText').textContent = d.healingName;
                document.getElementById('healingTitle').textContent = d.healingName || 'íë§ìŒì•…';
                document.getElementById('healingSubtitle').textContent = subtitleText + ' ìŒì•…';
                document.getElementById('healingDownload').href = toDirectLink(d.healingLink);
                audioStreamUrls['healing'] = toStreamUrl(d.healingLink);
                if (d.healingDesc) {
                    document.getElementById('healingDesc').textContent = d.healingDesc;
                    document.getElementById('healingDesc').style.display = 'block';
                }
            }

            /* ì§„ì… í˜ì´ë“œì•„ì›ƒ â†’ ë³´ì¦ì„œ í˜ì´ë“œì¸ */
            intro.classList.add('fade-out');
            setTimeout(function() {
                intro.style.display = 'none';
                cert.style.display = 'block';
                cert.classList.add('fade-in');

                /* í…Œë§ˆê³¡ ë°°ê²½ìŒì•… ìë™ ì¬ìƒ */
                if (audioStreamUrls['theme']) {
                    startBgm('theme');
                }
            }, 800);
        }

        /* â”€â”€ ë°°ê²½ìŒì•… (BGM) â”€â”€ */
        function startBgm(type) {
            bgmType = type;
            var audio = new Audio(audioStreamUrls[type]);
            audio.volume = 0;
            audioPlayers[type] = audio;
            audioLoaded[type] = true;

            audio.addEventListener('loadedmetadata', function() {
                document.getElementById(type + 'Duration').textContent = formatTime(audio.duration);
            });

            audio.addEventListener('canplay', function() {
                audio.play().then(function() {
                    /* ë³¼ë¥¨ í˜ì´ë“œì¸ */
                    var vol = 0;
                    var fadeIn = setInterval(function() {
                        vol += 0.05;
                        if (vol >= 1) { vol = 1; clearInterval(fadeIn); }
                        audio.volume = vol;
                    }, 100);

                    var bgmBar = document.getElementById('bgmBar');
                    bgmBar.classList.add('active');
                    document.getElementById('bgmTitle').textContent = 'â™ª ' + (certData.themeName || 'ë§ì¶¤í˜• ìŒì›');
                    document.getElementById('bgmBtn').textContent = 'â¸';

                    document.getElementById(type + 'PlayBtn').textContent = 'â¸';
                    document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('playing');
                    startProgress(type);
                }).catch(function() {});
            }, { once: true });

            audio.addEventListener('ended', function() {
                document.getElementById('bgmBar').classList.remove('active');
                document.getElementById(type + 'PlayBtn').textContent = 'â–¶';
                document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.remove('playing');
                bgmType = null;
            });

            audio.load();
        }

        function toggleBgm() {
            if (!bgmType || !audioPlayers[bgmType]) return;
            var audio = audioPlayers[bgmType];
            if (audio.paused) {
                audio.play();
                document.getElementById('bgmBtn').textContent = 'â¸';
                document.getElementById(bgmType + 'PlayBtn').textContent = 'â¸';
                document.getElementById('btn' + bgmType.charAt(0).toUpperCase() + bgmType.slice(1)).classList.add('playing');
            } else {
                audio.pause();
                document.getElementById('bgmBtn').textContent = 'â–¶';
                document.getElementById(bgmType + 'PlayBtn').textContent = 'â–¶';
                document.getElementById('btn' + bgmType.charAt(0).toUpperCase() + bgmType.slice(1)).classList.remove('playing');
            }
        }

        /* â”€â”€ PDF ë·°ì–´ â”€â”€ */
        function openPdfViewer() {
            if (!pdfViewerData.embedUrl) return;
            var overlay = document.getElementById('pdfOverlay');
            var frame = document.getElementById('pdfOverlayFrame');
            var loading = document.getElementById('pdfOverlayLoading');
            document.getElementById('pdfOverlayTitle').textContent = 'ğŸ“œ ' + pdfViewerData.title;
            document.getElementById('pdfOverlayDownload').href = pdfViewerData.downloadUrl;
            loading.style.display = 'flex';
            frame.style.display = 'none';
            overlay.classList.add('open');
            document.body.style.overflow = 'hidden';
            frame.onload = function() { loading.style.display = 'none'; frame.style.display = 'block'; };
            frame.src = pdfViewerData.embedUrl;
        }

        function closePdfViewer() {
            document.getElementById('pdfOverlay').classList.remove('open');
            document.body.style.overflow = '';
            document.getElementById('pdfOverlayFrame').src = '';
        }

        /* â”€â”€ í”Œë ˆì´ì–´ â”€â”€ */
        function togglePlayer(type) {
            var wrap = document.getElementById('player' + type.charAt(0).toUpperCase() + type.slice(1));
            var btn = document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1));
            var isOpen = wrap.classList.contains('open');

            ['theme', 'voice', 'healing'].forEach(function(t) {
                if (t !== type) {
                    var w = document.getElementById('player' + t.charAt(0).toUpperCase() + t.slice(1));
                    var b = document.getElementById('btn' + t.charAt(0).toUpperCase() + t.slice(1));
                    if (w) w.classList.remove('open');
                    if (b) b.classList.remove('expanded');
                }
            });

            if (isOpen) {
                wrap.classList.remove('open');
                btn.classList.remove('expanded');
            } else {
                wrap.classList.add('open');
                btn.classList.add('expanded');
                if (!audioLoaded[type] && audioStreamUrls[type]) {
                    loadAudio(type);
                }
            }
        }

        function loadAudio(type) {
            var url = audioStreamUrls[type];
            if (!url) return;

            /* ë‹¤ë¥¸ ìŒì› ì •ì§€ */
            ['theme', 'voice', 'healing'].forEach(function(t) {
                if (t !== type && audioPlayers[t] && !audioPlayers[t].paused) {
                    audioPlayers[t].pause();
                    document.getElementById(t + 'PlayBtn').textContent = 'â–¶';
                    document.getElementById('btn' + t.charAt(0).toUpperCase() + t.slice(1)).classList.remove('playing');
                }
            });

            if (bgmType && bgmType !== type) {
                document.getElementById('bgmBar').classList.remove('active');
                bgmType = null;
            }

            var audio = new Audio(url);
            audioPlayers[type] = audio;

            var loadingEl = document.getElementById(type + 'Loading');
            if (loadingEl) loadingEl.style.display = 'block';

            audio.addEventListener('canplay', function() {
                if (loadingEl) loadingEl.style.display = 'none';
                audioLoaded[type] = true;
                audio.play().catch(function(){});
                document.getElementById(type + 'PlayBtn').textContent = 'â¸';
                document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('playing');
                startProgress(type);
            }, { once: true });

            audio.addEventListener('loadedmetadata', function() {
                document.getElementById(type + 'Duration').textContent = formatTime(audio.duration);
            });

            audio.addEventListener('ended', function() {
                document.getElementById(type + 'PlayBtn').textContent = 'â–¶';
                document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.remove('playing');
                if (playerIntervals[type]) clearInterval(playerIntervals[type]);
            });

            audio.load();
        }

        function playPause(type) {
            var audio = audioPlayers[type];
            if (!audio) { loadAudio(type); return; }
            var playBtn = document.getElementById(type + 'PlayBtn');
            var btn = document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1));

            if (audio.paused) {
                ['theme', 'voice', 'healing'].forEach(function(t) {
                    if (t !== type && audioPlayers[t] && !audioPlayers[t].paused) {
                        audioPlayers[t].pause();
                        document.getElementById(t + 'PlayBtn').textContent = 'â–¶';
                        document.getElementById('btn' + t.charAt(0).toUpperCase() + t.slice(1)).classList.remove('playing');
                    }
                });
                audio.play().catch(function(){});
                playBtn.textContent = 'â¸';
                btn.classList.add('playing');
                startProgress(type);

                if (type === 'theme' || bgmType === type) {
                    document.getElementById('bgmBar').classList.add('active');
                    document.getElementById('bgmBtn').textContent = 'â¸';
                    bgmType = type;
                }
            } else {
                audio.pause();
                playBtn.textContent = 'â–¶';
                btn.classList.remove('playing');
                if (bgmType === type) {
                    document.getElementById('bgmBtn').textContent = 'â–¶';
                }
            }
        }

        function seek(type) {
            var audio = audioPlayers[type];
            var progress = document.getElementById(type + 'Progress');
            if (audio && audio.duration) {
                audio.currentTime = (progress.value / 100) * audio.duration;
            }
        }

        function startProgress(type) {
            if (playerIntervals[type]) clearInterval(playerIntervals[type]);
            playerIntervals[type] = setInterval(function() {
                var audio = audioPlayers[type];
                if (!audio) return;
                var progress = document.getElementById(type + 'Progress');
                var current = document.getElementById(type + 'Current');
                var duration = document.getElementById(type + 'Duration');
                if (audio.duration) {
                    var pct = (audio.currentTime / audio.duration) * 100;
                    progress.value = pct;
                    progress.style.background = 'linear-gradient(90deg, #c9a84c ' + pct + '%, #c9a84c22 ' + pct + '%)';
                    current.textContent = formatTime(audio.currentTime);
                    duration.textContent = formatTime(audio.duration);
                }
                if (audio.ended) {
                    document.getElementById(type + 'PlayBtn').textContent = 'â–¶';
                    document.getElementById('btn' + type.charAt(0).toUpperCase() + type.slice(1)).classList.remove('playing');
                    clearInterval(playerIntervals[type]);
                }
            }, 250);
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
        }
    </script>
</body>
</html>
